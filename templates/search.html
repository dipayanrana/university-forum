{{define "content"}}
<div class="row">
    <div class="col-lg-8 mx-auto">
        <!-- Search Header -->
        <div class="d-flex align-items-center justify-content-between mb-4">
            <h2 class="mb-0"><i class="bi bi-search me-2"></i>Search Discussions</h2>
            <a href="/" class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-arrow-left me-1"></i>Back to Home
            </a>
        </div>
        
        <!-- Search Form -->
        <div class="card mb-4">
            <div class="card-body">
                <form action="/search" method="GET" class="needs-validation" novalidate>
                    <div class="row g-3">
                        <div class="col-12">
                            <div class="position-relative">
                                <input type="text" name="q" class="form-control form-control-lg search-input" 
                                       placeholder="Search by keywords, author, or topic..." 
                                       value="{{.Query}}" required autofocus>
                                <button type="submit" class="search-button">
                                    <i class="bi bi-search"></i>
                                </button>
                                <div class="search-suggestions"></div>
                                <div class="invalid-feedback">
                                    Please enter search terms
                                </div>
                            </div>
                        </div>
                        
                        <!-- Advanced Search Options -->
                        <div class="col-12 mt-3">
                            <div class="collapse" id="advancedSearch">
                                <div class="card card-body bg-light">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Category</label>
                                            <select name="category" class="form-select">
                                                <option value="">All Categories</option>
                                                <option value="general" {{if eq .Category "general"}}selected{{end}}>General</option>
                                                <option value="academic" {{if eq .Category "academic"}}selected{{end}}>Academic</option>
                                                <option value="events" {{if eq .Category "events"}}selected{{end}}>Events</option>
                                                <option value="questions" {{if eq .Category "questions"}}selected{{end}}>Questions</option>
                                                <option value="campus" {{if eq .Category "campus"}}selected{{end}}>Campus Life</option>
                                                <option value="resources" {{if eq .Category "resources"}}selected{{end}}>Resources</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Sort By</label>
                                            <select name="sort" class="form-select">
                                                <option value="relevance" {{if eq .SortBy "relevance"}}selected{{end}}>Relevance</option>
                                                <option value="recent" {{if eq .SortBy "recent"}}selected{{end}}>Most Recent</option>
                                                <option value="popular" {{if eq .SortBy "popular"}}selected{{end}}>Most Popular</option>
                                                <option value="commented" {{if eq .SortBy "commented"}}selected{{end}}>Most Commented</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Date Range</label>
                                            <select name="date_range" class="form-select">
                                                <option value="any" {{if eq .DateRange "any"}}selected{{end}}>Any Time</option>
                                                <option value="day" {{if eq .DateRange "day"}}selected{{end}}>Past 24 Hours</option>
                                                <option value="week" {{if eq .DateRange "week"}}selected{{end}}>Past Week</option>
                                                <option value="month" {{if eq .DateRange "month"}}selected{{end}}>Past Month</option>
                                                <option value="year" {{if eq .DateRange "year"}}selected{{end}}>Past Year</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Author</label>
                                            <input type="text" name="author" class="form-control" placeholder="Author username" value="{{.Author}}">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex justify-content-end mt-2">
                                <a class="btn btn-link text-decoration-none" data-bs-toggle="collapse" href="#advancedSearch" role="button" aria-expanded="false" aria-controls="advancedSearch">
                                    <span class="advanced-search-toggle">
                                        <i class="bi bi-sliders me-1"></i>
                                        <span class="toggle-text">Show Advanced Search</span>
                                    </span>
                                </a>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Search Results -->
        {{if .Query}}
            <div class="d-flex align-items-center justify-content-between mb-3">
                <h4 class="mb-0">
                    <i class="bi bi-list-ul me-2"></i>Results for <span class="text-primary">"{{.Query}}"</span>
                </h4>
                {{if .Results}}
                <span class="badge bg-secondary">{{.TotalResults}} results found</span>
                {{end}}
            </div>
            
            <!-- Active Filters Display -->
            {{if or .Category .Author .DateRange}}
            <div class="mb-3">
                <div class="d-flex align-items-center flex-wrap">
                    <span class="me-2">Active filters:</span>
                    {{if .Category}}
                    <div class="badge bg-light text-dark me-2 mb-2">
                        Category: {{.Category}}
                        <a href="/search?q={{.Query}}{{if .SortBy}}&sort={{.SortBy}}{{end}}{{if .DateRange}}&date_range={{.DateRange}}{{end}}{{if .Author}}&author={{.Author}}{{end}}" class="text-decoration-none ms-1">×</a>
                    </div>
                    {{end}}
                    {{if .Author}}
                    <div class="badge bg-light text-dark me-2 mb-2">
                        Author: {{.Author}}
                        <a href="/search?q={{.Query}}{{if .Category}}&category={{.Category}}{{end}}{{if .SortBy}}&sort={{.SortBy}}{{end}}{{if .DateRange}}&date_range={{.DateRange}}{{end}}" class="text-decoration-none ms-1">×</a>
                    </div>
                    {{end}}
                    {{if .DateRange}}
                    <div class="badge bg-light text-dark me-2 mb-2">
                        Time: {{if eq .DateRange "day"}}Past 24 Hours{{else if eq .DateRange "week"}}Past Week{{else if eq .DateRange "month"}}Past Month{{else if eq .DateRange "year"}}Past Year{{end}}
                        <a href="/search?q={{.Query}}{{if .Category}}&category={{.Category}}{{end}}{{if .SortBy}}&sort={{.SortBy}}{{end}}{{if .Author}}&author={{.Author}}{{end}}" class="text-decoration-none ms-1">×</a>
                    </div>
                    {{end}}
                    <a href="/search?q={{.Query}}" class="btn btn-sm btn-link text-decoration-none">Clear All</a>
                </div>
            </div>
            {{end}}
            
            <!-- Results List -->
            {{if .Results}}
                {{range .Results}}
                <div class="card mb-3 search-result">
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-2">
                            <div class="avatar me-2">
                                {{if .AuthorAvatar}}
                                <img src="{{.AuthorAvatar}}" alt="{{.AuthorName}}" class="rounded-circle" width="36" height="36">
                                {{else}}
                                <div class="avatar-placeholder rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center" style="width: 36px; height: 36px;">
                                    {{slice .AuthorName 0 1}}
                                </div>
                                {{end}}
                            </div>
                            <div>
                                <div class="d-flex align-items-center">
                                    <a href="/search?q={{$.Query}}&author={{.AuthorName}}" class="me-2 fw-bold text-decoration-none">{{.AuthorName}}</a>
                                    <a href="/search?q={{$.Query}}&category={{.Category}}" class="badge bg-secondary text-decoration-none">{{.Category}}</a>
                                </div>
                                <small class="text-muted">{{.CreatedAt}}</small>
                            </div>
                        </div>
                        <h5 class="card-title">
                            <a href="/post/{{.ID}}" class="text-decoration-none">{{.HighlightedTitle | safeHTML}}</a>
                        </h5>
                        <p class="card-text">{{.HighlightedContent | safeHTML}}</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="post-stats d-flex">
                                <span class="me-3"><i class="bi bi-eye me-1"></i>{{.Views}}</span>
                                <span class="me-3"><i class="bi bi-chat-left me-1"></i>{{.CommentCount}}</span>
                                <span><i class="bi bi-heart me-1"></i>{{.LikeCount}}</span>
                            </div>
                            <a href="/post/{{.ID}}" class="btn btn-outline-primary btn-sm">Read More</a>
                        </div>
                        {{if .Tags}}
                        <div class="mt-2">
                            {{range .Tags}}
                            <a href="/search?q={{.}}" class="badge rounded-pill bg-light text-dark text-decoration-none me-1">
                                {{.}}
                            </a>
                            {{end}}
                        </div>
                        {{end}}
                    </div>
                </div>
                {{end}}
                
                <!-- Pagination -->
                {{if gt .TotalPages 1}}
                <nav aria-label="Search results pages">
                    <ul class="pagination justify-content-center">
                        <li class="page-item {{if eq .CurrentPage 1}}disabled{{end}}">
                            <a class="page-link" href="/search?q={{.Query}}&page={{subtract .CurrentPage 1}}{{if .Category}}&category={{.Category}}{{end}}{{if .SortBy}}&sort={{.SortBy}}{{end}}{{if .DateRange}}&date_range={{.DateRange}}{{end}}{{if .Author}}&author={{.Author}}{{end}}" aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>
                        
                        {{range $i := loop 1 .TotalPages}}
                        <li class="page-item {{if eq $i $.CurrentPage}}active{{end}}">
                            <a class="page-link" href="/search?q={{$.Query}}&page={{$i}}{{if $.Category}}&category={{$.Category}}{{end}}{{if $.SortBy}}&sort={{$.SortBy}}{{end}}{{if $.DateRange}}&date_range={{$.DateRange}}{{end}}{{if $.Author}}&author={{$.Author}}{{end}}">{{$i}}</a>
                        </li>
                        {{end}}
                        
                        <li class="page-item {{if eq .CurrentPage .TotalPages}}disabled{{end}}">
                            <a class="page-link" href="/search?q={{.Query}}&page={{add .CurrentPage 1}}{{if .Category}}&category={{.Category}}{{end}}{{if .SortBy}}&sort={{.SortBy}}{{end}}{{if .DateRange}}&date_range={{.DateRange}}{{end}}{{if .Author}}&author={{.Author}}{{end}}" aria-label="Next">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                    </ul>
                </nav>
                {{end}}
            {{else}}
                <div class="alert alert-info">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-info-circle-fill me-3 fs-4"></i>
                        <div>
                            <h5 class="mb-1">No results found for "{{.Query}}"</h5>
                            <p class="mb-0">Try different keywords or refine your search criteria.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Search Tips -->
                <div class="card mt-4">
                    <div class="card-header bg-white">
                        <h5 class="mb-0"><i class="bi bi-lightbulb me-2"></i>Search Tips</h5>
                    </div>
                    <div class="card-body">
                        <ul class="mb-0">
                            <li>Use specific keywords related to your topic</li>
                            <li>Try alternative terms or synonyms</li>
                            <li>Check your spelling</li>
                            <li>Use the Advanced Search options to refine results</li>
                            <li>Search by category, author, or time period</li>
                        </ul>
                    </div>
                </div>
            {{end}}
        {{else}}
            <!-- Search Suggestions if no query -->
            <div class="card">
                <div class="card-header bg-white">
                    <h5 class="mb-0"><i class="bi bi-journal-text me-2"></i>Popular Search Topics</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="mb-2">Academic</h6>
                            <div class="d-flex flex-wrap gap-2 mb-3">
                                <a href="/search?q=exams" class="badge rounded-pill bg-light text-dark text-decoration-none">Exams</a>
                                <a href="/search?q=homework" class="badge rounded-pill bg-light text-dark text-decoration-none">Homework</a>
                                <a href="/search?q=research" class="badge rounded-pill bg-light text-dark text-decoration-none">Research</a>
                                <a href="/search?q=projects" class="badge rounded-pill bg-light text-dark text-decoration-none">Projects</a>
                                <a href="/search?q=papers" class="badge rounded-pill bg-light text-dark text-decoration-none">Papers</a>
                            </div>
                            
                            <h6 class="mb-2">Campus Life</h6>
                            <div class="d-flex flex-wrap gap-2">
                                <a href="/search?q=housing" class="badge rounded-pill bg-light text-dark text-decoration-none">Housing</a>
                                <a href="/search?q=clubs" class="badge rounded-pill bg-light text-dark text-decoration-none">Clubs</a>
                                <a href="/search?q=dining" class="badge rounded-pill bg-light text-dark text-decoration-none">Dining</a>
                                <a href="/search?q=events" class="badge rounded-pill bg-light text-dark text-decoration-none">Events</a>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6 class="mb-2">Resources</h6>
                            <div class="d-flex flex-wrap gap-2 mb-3">
                                <a href="/search?q=textbooks" class="badge rounded-pill bg-light text-dark text-decoration-none">Textbooks</a>
                                <a href="/search?q=online+courses" class="badge rounded-pill bg-light text-dark text-decoration-none">Online Courses</a>
                                <a href="/search?q=tutoring" class="badge rounded-pill bg-light text-dark text-decoration-none">Tutoring</a>
                                <a href="/search?q=scholarships" class="badge rounded-pill bg-light text-dark text-decoration-none">Scholarships</a>
                            </div>
                            
                            <h6 class="mb-2">General</h6>
                            <div class="d-flex flex-wrap gap-2">
                                <a href="/search?q=advice" class="badge rounded-pill bg-light text-dark text-decoration-none">Advice</a>
                                <a href="/search?q=careers" class="badge rounded-pill bg-light text-dark text-decoration-none">Careers</a>
                                <a href="/search?q=internships" class="badge rounded-pill bg-light text-dark text-decoration-none">Internships</a>
                                <a href="/search?q=health" class="badge rounded-pill bg-light text-dark text-decoration-none">Health</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {{end}}
    </div>
</div>

<!-- Scripts for this template -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Toggle advanced search text
    const advancedSearchToggle = document.querySelector('.advanced-search-toggle');
    const advancedSearchCollapse = document.getElementById('advancedSearch');
    const toggleText = document.querySelector('.toggle-text');
    
    if (advancedSearchToggle && advancedSearchCollapse && toggleText) {
        advancedSearchCollapse.addEventListener('shown.bs.collapse', function () {
            toggleText.textContent = 'Hide Advanced Search';
            advancedSearchToggle.querySelector('i').classList.remove('bi-sliders');
            advancedSearchToggle.querySelector('i').classList.add('bi-sliders-vertical');
        });
        
        advancedSearchCollapse.addEventListener('hidden.bs.collapse', function () {
            toggleText.textContent = 'Show Advanced Search';
            advancedSearchToggle.querySelector('i').classList.remove('bi-sliders-vertical');
            advancedSearchToggle.querySelector('i').classList.add('bi-sliders');
        });
    }
});
</script>

<!-- CSS for this template only -->
<style>
.search-result {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.search-result:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.1);
}

mark {
    background-color: rgba(255, 193, 7, 0.4);
    padding: 0 2px;
    border-radius: 2px;
}

.avatar-placeholder {
    font-weight: bold;
}
</style>
{{end}} 